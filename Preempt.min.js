/**
 * preemt.js
 * ==========
 * https://github.com/bengourley/Preempt
 * Licenced under the New BSD License
 */(function(){function t(n,r){if(!(this instanceof t))return new t(r);this.input=n,this.cursor=null,this.results=[],this.options=_.extend({},e,r)}var e={limit:5,template:_.template('<li class="preempt-result"><%=text%></li>'),header:null,footer:null,urlProperty:"href"};t.prototype.init=function(){this.setup(),this.input.on("keyup",_.bind(this.handleKeyUp,this)),this.input.on("keydown",_.bind(this.handleKeyDown,this))},t.prototype.setup=function(){this.input.attr("autocomplete","off"),this.root=$("<div/>").addClass("preempt-root"),this.container=$("<div/>").addClass("preempt-result-container"),this.resultsEl=$("<ul/>").addClass("preempt-result-list"),this.root.append(this.container),this.input.after(this.root),this.clear(),this.options.header&&this.container.append(this.options.header),this.container.append(this.resultsEl),this.options.footer&&this.container.append(this.options.footer)},t.prototype.handleKeyUp=function(e){if(e.keyCode===27)this.clear();else if(!this.results.length||e.keyCode!==38&&e.keyCode!==40)this.results.length&&e.keyCode===13&&this.hasCursor()?document.location.href=this.results[this.cursor][this.options.urlProperty]:(this.input.addClass("loading"),this.getResults(_.bind(function(e){this.input.removeClass("loading"),this.cursor=null,this.results=e,this.render()},this)));else{var t=this.resultsEl.children();this.hasCursor()&&t.eq(this.cursor).removeClass("cursor"),e.keyCode===40&&(this.hasCursor()?this.cursor=this.cursor===t.length-1?this.cursor:this.cursor+1:this.cursor=0),e.keyCode===38&&(this.hasCursor()?this.cursor=this.cursor===0?this.cursor:this.cursor-1:this.cursor=t.length-1),t.eq(this.cursor).addClass("cursor")}},t.prototype.handleKeyDown=function(e){e.keyCode===13&&this.hasCursor()&&e.preventDefault(),(e.keyCode===38||e.keyCode===40)&&e.preventDefault(),e.keyCode===9&&this.clear()},t.prototype.hasCursor=function(e){return typeof this.cursor=="number"},t.prototype.getResults=function(e){if(this.input.val()==="")return e([]);this.options.query(this.input.val(),_.bind(function(t){e(t)},this))},t.prototype.clear=function(){this.results=[],this.cursor=null,this.container.hide(),$(document).off("click.preempt"),this.root.off("click")},t.prototype.click=function(e){this.clear()},t.prototype.show=function(){this.container.show(),$(document).one("click.preempt",_.bind(this.click,this)),this.root.on("click",function(e){e.stopPropagation()})},t.prototype.render=function(){this.resultsEl.empty(),this.container.hide(),this.results.length&&(_.each(this.results,function(e,t){if(t>=this.options.limit)return;this.resultsEl.append(this.options.template(e))},this),this.root.css({top:this.input.position().top+this.input.outerHeight(!0)}),this.show())},window.module&&window.require?module("Preempt",function(e){e.exports=t}):window.Preempt=t})();